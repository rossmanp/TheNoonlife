@model TheNoonlife.Models.ApplicationUser

@{
    ViewBag.Title = "UserHomePage";
}
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="~/Content/custom.css" rel="stylesheet" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<body>
    <div class="w3-container">   
    </div>
        <div class="container" id="mainContainer">
            <div class="jumbotron">
                <div class="row">
                   <div class="col-sm-6">
                <h3>Select Something Tasty Below</h3>
                     </div>
                    <div class="col-sm-6">
                        <h3> Or Search Your Fancy</h3>
                        @using (Html.BeginForm("FindBrunchWithSearch", "Home"))
                        {
                            @Html.TextBox("LocationName")
                            <input class="pull-right" type="submit" />
                        }

                        @Html.DisplayFor(m => m.FavoriteRestaurant)
                    </div>
                    </div>
                 <div class="row" id="results"></div>
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <!-- Indicators -->
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                        <li data-target="#myCarousel" data-slide-to="1"></li>
                        <li data-target="#myCarousel" data-slide-to="2"></li>
                        <li data-target="#myCarousel" data-slide-to="3"></li>
                    </ol>

                    <!-- Wrapper for slides -->
                    <div class="carousel-inner">
                        <div class="item active">
                            <a class="imglink" href="#" data-category="chinese"><img src="~/Content/images/chinese.jpg" alt="Los Angeles" style="width:100%;"></a>
                        </div>

                        <div class="item">
                            <a class="imglink" href="#" data-category="italian"><img src="~/Content/images/Italian-food-recipes-not-from-italy-at-all.jpg" alt="Chicago" style="width:100%;"></a>
                        </div>

                        <div class="item">
                            <a class="imglink" href="#" data-category="mexican"><img src="~/Content/images/Mexican-food-healthy-large.jpg" alt="New york" style="width:100%;"></a>
                        </div>
                        <div class="item">
                            <a class="imglink" href="#" data-category="american"><img src="~/Content/images/youve-seen-the-most-american-foods.jpg" alt="New york" style="width:100%;"></a>
                        </div>
                    </div>

                    <!-- Left and right controls -->
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
    </div>
</body>
<script type="text/javascript">
    // 1. get user location lat and long
    var lat, long;
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }
    function showPosition(position) {
        console.log("Latitude: " + position.coords.latitude
        + "<br>Longitude: " + position.coords.longitude);
        lat = position.coords.latitude;
        long = position.coords.longitude;
        console.log(lat, long);
            }
    // 2. listen for click on any of the images

    $('.imglink').click(function () {
        var cat = $(this).data('category');
        console.log(cat);

        var passData = {
            Latitude: lat,
            Longitude: long,
            Category: cat
        }

        $.ajax({
            method: "POST",
            url: "/Home/ajaxLookup",
            data: passData
        })
          .done(function (msg) {
              console.log(msg);
              $("#myCarousel").hide("slow");
              $("#results").append("<table class='table table-responsive table-striped' id='resultsTable'><thead><th></th><th>Restaurant Name</th><th>Price Range</th></thead><tbody></tbody>")

              for (x in msg.restaurants) {
                  var markup = "<tr><td><img class='list-img' src=" + msg.restaurants[x].Picture + "></img></td><td>" + msg.restaurants[x].Name + "</td><td>" + msg.restaurants[x].Price + "</td></tr>";
                  $("#resultsTable tbody").append(markup);
              }

              

 
          });
    })
    // 3 on click, pass food category and user lat/long to controller
    // 4. in controller make api call to yelp with lat/long and category and return response to ajax success
    // 5. options: update the view html in place with results or redirect to new page. I like the first option.

    getLocation();
</script>
